

{% extends 'base.html' %}
{% block content %}
<body>
    <!-- This div is all about the monthly chart. Getting a specific month and displaying it -->
    <div id='byMonthChart'>
        <form>
            Select the month which you'd like to view the log (logs are viewable for the next 6 months):
            <select name="month" id='monthChartmonth'>
              <option value='none'></option>
              {% for month in available_months %}
              <option value={{ month }}> {{month}} </option>
              {% endfor %}
            </select>
            <input type='submit' id='submitformonthlychart'>
        </form>
        <div class='monthly-chart'>
            <canvas id='bubbleChartMonth'></canvas>
        </div>
    </div>

    <!-- This div is all about the building chart. Getting a specific month, building and door and displaying it -->
    <div id='byBuildingChart'>
        <form>
            Select the month, building and door id which you'd like to view the log (logs are viewable for the next 6 months). <br>
            Select month:
            <select name="month" id='buildingChartmonth'>
              <option value='none'></option>
              {% for month in available_months %}
              <option value={{ month }}> {{month}} </option>
              {% endfor %}
            </select>
            Select building:
            <select name="building" id='buildingChartbuilding'>
              <option value='none'></option>
              {% for building in available_buildings %}
              <option value={{ building }}> {{building}} </option>
              {% endfor %}
            </select>
            <input type='submit' id='submitforbuildingchart'>
        </form>
        <div id='door_ids_dynamic'>
            <p> Testing the area for the new buttons</p>
            <!-- adding in dynamically numbered?amount? buttons here -->
        </div>
        <div id='byBuildingChart'>
            <div class='monthly-chart'>
                <canvas id='bubbleChartBuilding'></canvas>
            </div>
        </div>
    </div>

    <!-- This the JS script that generates the charts-->
    <script>
        // This one deafults the ticks on the charts to 1. 
        Chart.scaleService.updateScaleDefaults('linear', {
        ticks: {
            stepSize: 1
        }})
        
        // This are the options for the charts
        var my_options = {
            reposive:true,
            maintainAspectRatio:true,
            scales: {
                xAxes: [{
                    ticks: {
                        max: 31,
                        min: 0,  } }],
                yAxes: [{
                    ticks: {
                        min: 0  } }]
            }   
        }
        // This is the code needed to build the chart based on the user's 
        // selection of the month
        var ctx_bubble_M = $("#bubbleChartMonth").get(0).getContext("2d");

        var monthToBepassed = $('#monthChartmonth option:selected').text();
            console.log(monthToBepassed);

        var buildMonthlyChart = function(evt) {
            var monthToBepassed = $('#monthChartmonth option:selected').text();
            evt.preventDefault(); 
            $.get("/monthly.json", {'month': monthToBepassed}, function (data) {
                var myBubbleChart = new Chart(ctx_bubble_M,{
                type: 'bubble',
                data: data,
                options: my_options        
                });
            });
        };

        // This is the code needed to build the chart based on the user's
        // selection of the month and building name
        var ctx_bubble_B = $("#bubbleChartBuilding").get(0).getContext("2d");

        var buildBuildingChart = function(evt) {
            $('.door_btn').remove();
            var secondMonthToBepassed = $('#buildingChartmonth option:selected').text();
            var buildingToBepassed = $('#buildingChartbuilding option:selected').text();
            evt.preventDefault(); 
            $.get("/building.json", {'month': secondMonthToBepassed, 'building' : buildingToBepassed}, function (data) {

                for (var key in data) { 
                    var charts_list = data[key];
                    var charts_list_len = charts_list.length;
                    for (var i = 0; i<charts_list_len; i++) {
                        var myBubbleChart = new Chart(ctx_bubble_B,{
                        type: 'bubble',
                        data: charts_list[i],
                        options: my_options 
                });
                        // Code for making the buttons for the building charts to toggle which door chart to show
                        var button_div = document.getElementById('door_ids_dynamic')
                        var btn = document.createElement("BUTTON");
                        // getting the label for the buttons
                        for (var data_key in charts_list) {
                            console.log(data_key[i])
                        }
                        var num_btn = i;
                        var btn_label = document.createTextNode(num_btn);
                        btn.appendChild(btn_label);
                        btn.setAttribute('class', 'door_btn')
                        btn.setAttribute('id', i)
                        button_div.appendChild(btn);
        
                    }}
            });
        };
        // this is the end of making chart by building by month
        

        // Event listners that will call the functions to build the charts        
        $('#submitformonthlychart').click(buildMonthlyChart);
        $('#submitforbuildingchart').click(buildBuildingChart);
    

        




    </script>


{% endblock %}